<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <title>BuiVanQuan,</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="container">
        <h2>cURL Command Generator</h2>

        <label>Endpoint URL:</label>
        <input type="text" id="endpoint" placeholder="https://example.com/api" autocomplete="off">

        <label>Query Parameters (Key=Value, one per line):</label>
        <textarea id="queryParams" placeholder="param1=value1\nparam2=value2"></textarea>

        <label>HTTP Method:</label>
        <select id="method">
            <option value="GET">GET</option>
            <option value="POST">POST</option>
            <option value="PUT">PUT</option>
            <option value="DELETE">DELETE</option>
        </select>

        <label>Headers (Key:Value, one per line):</label>
        <textarea id="headers" placeholder="x-api-key:your_api_key"></textarea>

        <label>Authorization Type:</label>
        <select id="authType" onchange="toggleAuthFields()">
            <option value="none">None</option>
            <option value="bearer">Bearer Token</option>
            <option value="basic">Basic Auth</option>
        </select>

        <div id="bearerAuth" style="display: none;">
            <label>Bearer Token:</label>
            <input type="text" id="bearerToken" placeholder="Enter Bearer Token" autocomplete="off">
        </div>

        <div id="basicAuth" style="display: none;">
            <label>Username:</label>
            <input type="text" id="basicUser" placeholder="Enter Username" autocomplete="off">
            <label>Password:</label>
            <input type="password" id="basicPass" placeholder="Enter Password" autocomplete="off">
        </div>

        <label>Body (JSON for POST/PUT requests):</label>
        <textarea id="body" rows="10" placeholder='{"key": "value"}'></textarea>

        <div class="action-btn">
            <button onclick="generateCurl()">Generate</button>
        </div>
    </div>

    <div class="container">
        <h3>Generated cURL command</h3>
        <p id="copyMessage" style="color: green; margin: 0px;"></p>
        <textarea id="curlCommand" rows="10" placeholder="curl" readonly></textarea>

        <h3>Endpoint history</h3>
        <div class="action-btn">
            <button onclick="clearEndpointHistory()">Clear</button>
        </div>
        <pre id="endpointHistory"></pre>

        <h3>Command history</h3>
        <div class="action-btn">
            <button onclick="clearCurlHistory()">Clear</button>
        </div>
        <pre id="curlHistory"></pre>
    </div>

    <script>
        function toggleAuthFields() {
            const authType = document.getElementById("authType").value;
            document.getElementById("bearerAuth").style.display = authType === "bearer" ? "block" : "none";
            document.getElementById("basicAuth").style.display = authType === "basic" ? "block" : "none";
        }

        function generateCurl() {
            const endpointInput = document.getElementById("endpoint");
            let endpoint = endpointInput.value.trim();
            if (!endpoint) return;

            const method = document.getElementById("method").value;
            const headersInput = document.getElementById("headers").value;
            const body = document.getElementById("body").value;
            const authType = document.getElementById("authType").value;
            const queryParams = document.getElementById("queryParams").value;

            if (queryParams.trim()) {
                const queryString = queryParams.split("\n").map(param => param.trim()).filter(Boolean).join("&");
                endpoint += `?${queryString}`;
            }

            let curlCommand = `curl -X ${method} "${endpoint}"`;

            if (authType === "bearer") {
                const bearerToken = document.getElementById("bearerToken").value;
                if (bearerToken) {
                    curlCommand += ` \\\n  -H 'Authorization: Bearer ${bearerToken}'`;
                }
            }

            if (authType === "basic") {
                const basicUser = document.getElementById("basicUser").value;
                const basicPass = document.getElementById("basicPass").value;
                if (basicUser && basicPass) {
                    const basicAuth = btoa(`${basicUser}:${basicPass}`);
                    curlCommand += ` \\\n  -H 'Authorization: Basic ${basicAuth}'`;
                }
            }

            if (headersInput.trim()) {
                const headers = headersInput.split("\n").map(h => h.trim()).filter(Boolean);
                headers.forEach(h => {
                    curlCommand += ` \\\n  -H '${h}'`;
                });
            }

            if ((method === "POST" || method === "PUT") && body.trim()) {
                curlCommand += ` \\\n  -H 'Content-Type: application/json'`;
                const minifiedBody = minifyJsonStringPreserveValues(body);
                if (minifiedBody) {
                    curlCommand += ` \\\n  -d '${minifiedBody}'`;
                }
            }

            curlCommand += " \\\n | jq";

            // Save history
            let curlHistory = JSON.parse(localStorage.getItem("curlHistory")) || [];
            curlHistory.unshift(curlCommand);
            localStorage.setItem("curlHistory", JSON.stringify(curlHistory));
            updateCurlHistory();

            let endpointHistory = JSON.parse(localStorage.getItem("endpointHistory")) || [];
            if (!endpointHistory.includes(endpoint)) {
                endpointHistory.push(endpoint);
                localStorage.setItem("endpointHistory", JSON.stringify(endpointHistory));
            }
            updateEndpointHistory();

            document.getElementById("curlCommand").textContent = curlCommand;
            document.getElementById("copyMessage").innerText = "";
        }

        function updateCurlHistory() {
            let curlHistory = JSON.parse(localStorage.getItem("curlHistory")) || [];
            document.getElementById("curlHistory").textContent = curlHistory.join("\n\n--------------------------------------------------------\n\n");
        }

        function clearCurlHistory() {
            localStorage.removeItem("curlHistory");
            document.getElementById("curlHistory").textContent = "";
        }

        function updateEndpointHistory() {
            let endpointHistory = JSON.parse(localStorage.getItem("endpointHistory")) || [];
            document.getElementById("endpointHistory").textContent = endpointHistory.join("\n");
        }

        function clearEndpointHistory() {
            localStorage.removeItem("endpointHistory");
            document.getElementById("endpointHistory").textContent = "";
        }

        function minifyJsonStringPreserveValues(jsonString) {
            try {
                // Parse the JSON to an object
                const jsonObject = JSON.parse(jsonString);
                // Convert back to string without extra spaces
                return JSON.stringify(jsonObject);
            } catch (error) {
                console.error("Invalid JSON string:", error);
                return null;
            }
        }

        function autoCopyTextAreaValue() {
            document.getElementById("curlCommand").addEventListener("focus", function () {
                this.select();
                document.execCommand("copy");
                document.getElementById("copyMessage").innerText = "Đã sao chép!";
            });
        }

        window.onload = function () {
            updateEndpointHistory();
            updateCurlHistory();
            autoCopyTextAreaValue();
        };
    </script>
</body>

</html>
